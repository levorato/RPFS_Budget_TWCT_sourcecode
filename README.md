# RPFS_Budget_TWCT
m-machine Robust Permutation Flow Shop Problem under budgeted uncertainty, Total Weighted Completion Time Objective (Rob-PFSP-TWCT) : Source code and experiment result files for the paper `Robust permutation flow shop total weighted completion time problem: solution and application to the oil and gas industry`.

* Column-and-Constraint Generation (C&CG) exact algorithms implemented in Julia and C++

You are free to use the source code and problem instances, if you cite the following work (to be published):

```
@article{Levorato2022,
author = {Levorato, M. and Sotelo, D. and Figueiredo, R. and Frota, Y.},
journal = {Computers \& Operations Research},
keywords = {Scheduling, Robust Optimization, Permutation Flow Shop, Total Weighted Completion Time, Offshore platform maintenance},
title = {{Robust permutation flow shop total weighted completion time problem: solution and application to the oil and gas industry}},
year = {2022}
}
```

# Experimental Data - Instructions

### Instance files for Rob-PFSP-TWCT

* Instance files are located in the folder `instances/robust/ying/rob-pfsp-wct` of this repository. 
* Each subfolder containts the set of instance files of a different size. 
* Instance filenames use the following pattern: `RB<number_of_jobs_n>01<seq>_<number_of_jobs_n>_<number_of_machines_m>_<alpha>_wct_inputs.txt`. A detailed description of `n`, `m`, `seq` and `alpha` is presented below, in the experimental results description.


### Experimental results

All experimental results can be found in the Excel file `RPFS_TWCT_all_results.xlsx` located in the root folder of this repository.

Here's a brief description of each column:

* `model`: Robust-Counterpart (RC) model name used to solve the Master Problem (MP) inside the Column-and-Constraint (C&CG) algorithm (e.g., Liao-You). If `model` has the `Hybrid` suffix (e.g., Manne-Hybrid)), the Master Problem was solved using the hybrid solution approach, described in the paper (`Levorato et al. (2022)`).
* `n`: Number of jobs.
* `m`: Number of machines.
* `alpha`: $\alpha$ or $\alpha_{max}$ value used to generate the maximum allowed deviations in processing time values P_hat ($\widehat{P}$). 
* `seq`: sequential number depicting the basic `P_bar` nominal processing time matrix used to generate the instance.
* `instance_type`: type of instance generated (e.g., `ying` instances follow the generation recipe introduced by Ying (2015)).
* `instance_name`: instance filename (instances are located in the folder `instances/robust/ying/rob-pfsp-wct` of this repository). 
* `RobCost_Gamma`: budget parameter Gamma ($0 \leq \Gamma \leq mn$) value used to solve the instance. This parameter has a maximum value of $mn$ (number of operations).  
* `Gamma%`: relative budget parameter $\Gamma$ % value used to solve the instance: Gamma % $ = 100 \Gamma / (m n)$.
* `wct`: Total Weighted Completion Time (TWCT) value returned by the solution method. 
* `permutation`: the job permutation $\sigma$ returned as solution.
* `time`: total time spent to solve the problem (includes Master Problem and Sub Problem solution times). 
* `mp_total_time`: total Master Problem solution time, in seconds.
* `sp_total_time`: total Sub Problem solution time, in seconds.
* `iterations`: number of Column-and-Constraint iterations performed.
* `cut_count`: total number of distinct scenarios generated by the sub problem and added as cuts to the Master Problem.
* `lb`: lower bound to the optimal TWCT solution value.
* `cost`: solution cost (TWCT) returned by the C\&CG solution method (serves as upper bound to the optimal solution value).
* `gap`: optimal solution gap value: $gap = (cost - lb)/lb$.
* `optimal`: indicates that the solution found is optimal or not (True of False).

### References

```
@article{Ying2015,
author = {Ying, Kuo Ching},
doi = {10.1057/jors.2014.100},
issn = {14769360},
journal = {Journal of the Operational Research Society},
keywords = {flowshop scheduling problems,meta-heuristics,two-machine,uncertain job processing times},
number = {9},
pages = {1413--1425},
title = {{Scheduling the two-machine flowshop to hedge against processing time uncertainty}},
volume = {66},
year = {2015}
}
```


# Build instructions for the C++ program (Hybrid C&CG algorithm)

The following instructions are based on Ubuntu Linux 20.04 (Focal Fossa).

## 1. Ubuntu Linux packages intallation

```
sudo apt-get update
sudo apt-get install -y --no-install-recommends ca-certificates bzip2 curl wget tar nano zip unzip
sudo apt-get install -y --no-install-recommends cmake file git g++ build-essential cmake libboost-all-dev
```

## 2. Clone the `glog` repo library into the `glog` folder

* Inside the `RPFS_Budget_TWCT` folder, run:

```
git submodule update --init
```

## 3. CPLEX Installation

### 3.1. Download CPLEX installer from IBM website

* Download CPLEX installer from its website (academic licenses can be obtained from IBM website for free).

### 3.2. Run CPLEX installer

* [Follow the instructions from IBM website](https://www.ibm.com/docs/en/icos/20.1.0?topic=2010-installing-cplex-optimization-studio).

### 3.3. Setup CPLEX environment variables

* In the `~/.bashrc` file, configure `LD_LIBRARY_PATH` before running the program, where `<path_to_cplex_dir>` is the directory where CPLEX was installed (e.g., `/opt/ibm/ILOG/CPLEX_Studio1290`):
```
LD_LIBRARY_PATH=<path_to_cplex_dir>/opl/lib/x86-64_linux/static_pic:<path_to_cplex_dir>/concert/lib/x86-64_linux/static_pic:<path_to_cplex_dir>/cplex/lib/x86-64_linux/static_pic:<path_to_cplex_dir>/opl/lib/x86-64_linux/shared_pic:<path_to_cplex_dir>/opl/bin/x86-64_linux
```

## 4. Build the RPFS_Budget_TWCT project

### 4.1. Run cmake

```
mkdir build
cd build
cmake ..
```

### 4.2. Run make

```
make
```

* The `pfsp` executable will be available in the folder `bin`, inside the project folder.


## 5. Run the Hybrid C&CG program

### 5.1. Run the Hybrid C&CG program (C++)

* From the project folder, run the program using the arguments:
```
./bin/pfsp --input-file-dir ./instances/random/v2 --output-folder ./output --model-version=607
```
* Or use one of the existing Julia experiment scripts, located in the folder `src/julia/experiments/wct/global` (e.g., `wct_bud_sep_hybrid-tba_10x5.sh` for the Hybrid C&CG algorithm). **Note:** to run these scripts, you need to setup the Julia C&CG program before (see the next instructions). 


# Run instructions for the Julia C&CG program

## 1. Gurobi installation

### 1.1. Download Gurobi installer and obtain the `.lic` license file

* Download Gurobi installer from its website.
* Obtain the Gurobi license file `gurobi.lic` from its website (academic license can be obtained from Gurobi website for free).

### 1.2. Decompress Gurobi into the installation folder

* Copy the downloaded installer into the `/opt` folder (or into your home folder if you do not posses admin privileges):
```
sudo cp /home/ubuntu/Downloads/gurobi9.5.2_linux64.tar.gz /opt
```
* Decompress the file. A new folder named `gurobi952` will appear.
```
tar -xvf gurobi9.5.2_linux64.tar.gz
```

### 1.3. Copy the downloaded `gurobi.lic` license file to your home folder

```
cp /home/ubuntu/Downloads/gurobi.lic /home/ubuntu/gurobi.lic
```

### 1.4. Setup Gurobi environment variables

* Configure the following environment variables, where `<installdir> = /opt/gurobi952/linux64`:
```
GUROBI_HOME should point to your <installdir>.
PATH should be extended to include <installdir>/bin.
LD_LIBRARY_PATH should be extended to include <installdir>/lib.
```
* Bash shell users should add the following lines into the `.bashrc` file:
```
export GUROBI_HOME="/opt/gurobi952/linux64"
export PATH="${PATH}:${GUROBI_HOME}/bin"
export LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:${GUROBI_HOME}/lib"
```
* If the environment variable `LD_LIBRARY_PATH` is not defined in the `.bashrc` file, add the following replacement line:
```
export LD_LIBRARY_PATH="${GUROBI_HOME}/lib"
```


## 2. Set-up the application config files

### 2.1. Set the username from the operating system

Edit the file `src/julia/config.jl` and change the variables `USER_NAME` to match your username.
```
USER_NAME = "ubuntu"
```


## 3. Julia installation

## 3.1. Download Julia 1.6.0 from its website

https://julialang.org/downloads/

## 3.2. Decompress Julia to your home folder
```
cd /home/ubuntu
tar -xzf julia-1.6.0-linux-x86_64.tar.gz
```

## 3.3. Run Julia and install the required packages

* Install all the Julia packages listed in the file `src/julia/packages.txt`.

## 3.4. Run one of the Julia experiment script files

* See the folder `src/julia/experiment/wct/global` and choose a file.

